syntax = "proto3";

package PGo;

message MapObjectsRequest {
  Cell cell_request = 1;
  bytes unknown2 = 2;
  double lat = 3;
  double long = 4;
}

message Cell {
  repeated uint64 typea = 402653184;
  repeated uint64 typeb = 134217728;
}

// The response sent in response to the map object request
message MapObjectsResponse {
  repeated Tile tiles = 1;
}

// A tile is a geographical "zone" containing objects like pokemon, gyms, and pokestops
//http://s2map.com/#order=latlng&mode=polygon&s2=false&points=
//https://code.google.com/archive/p/s2-geometry-library/
message Tile {
  uint64 id = 1;
  uint64 current_timestamp = 2;
  repeated Fort forts = 3;
  repeated Location location4 = 4;

  // The closest pokemon, if it is within 2 "steps" or closer
  repeated PokemonSpawnA close_pokemon_a = 5;
  repeated Location location9 = 9;
  repeated PokemonSpawnB close_pokemon_b = 10;
  repeated Pokemon pokemon_in_area = 11;
}

// This could probably be moved to shared .proto
enum Team {
  UNDEFINED = 0;
  BLUE = 1;
  RED = 2;
  YELLOW = 3;
}

// A "fort" is the internal name for a gym or pokestop point of interest
message Fort {
  string id = 1;
  uint64 timestamp = 2;
  double latitude = 3;
  double longitude = 4;

  // applies only to a gym fort
  Team team = 5;
  uint64 GuardPokemonId = 6;
  bool not_sure8 = 8;
  bool isPokestop = 9; // applies only to a pokestop fort
  uint64 prestige = 10;
  bool IsInBattle = 11;

  // applies only to a pokestop fort with a lure attached
  bytes activeModuleId = 12;
  FortLureInfo fort_lure_info = 13;

  // applies only to a pokestop fort
  uint64 reset = 14;
}

message FortLureInfo {
  string fort_id = 1;
  double not_sure2 = 2; // TODO: not sure what this is
  uint64 pokedex = 3; // TODO: needs validation
  uint64 expiry = 4;
}

message PokemonSpawnA {
  double uid = 1;
  uint64 appeared_ts = 2; // TODO: needs validation
  double latitude = 3;
  double longitude = 4;
  string s2cell_token = 5; // TODO: not sure what this is - same as not_sure1 in ClosestPokemonUnspawnInfo

  message PokedexNumber {
    uint64 pokedex_number = 2;
  }
  PokedexNumber pokedex_number = 7;

  int32 not_sure11 = 11; // TODO: not sure what this is
}

message PokemonSpawnB {
    string s2cell_token = 1;
    double uid = 2;
    uint64 pokedex_number = 3;
    uint64 expiry = 4;
    double latitude = 5;
    double longitude = 6;
}

message Pokemon {
  uint64 pokedex = 1;
  float distance = 2; // TODO: needs validation
  double id = 3;
}

message Location {
  double latitude = 2;
  double longitude = 3;
}
