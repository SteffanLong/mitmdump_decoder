syntax = "proto3";

package PGo;

message MapObjectsRequest {
  Cell cell_request = 1;
  bytes unknown2 = 2;
  double lat = 3;
  double long = 4;
}

message Cell {
  repeated uint64 typea = 402653184;
  repeated uint64 typeb = 134217728;
}

// The response sent in response to the map object request
message MapObjectsResponse {
  repeated Tile tiles = 1;
}

// A tile is a geographical "zone" containing objects like pokemon, gyms, and pokestops
message Tile {
  // S2 geographic area that the tile covers (http://s2map.com/) (https://code.google.com/archive/p/s2-geometry-library/)
  uint64 id = 1;

  uint64 current_timestamp = 2;
  repeated Fort forts = 3;
  repeated Location grass = 4; // TODO: not sure what this represents

  // The closest pokemon, if it is within 2 "steps" or closer. This pokemon will NOT also be in pokemon_in_area
  repeated PokemonSpawnStart spawn_start = 5;
  repeated Location location9 = 9; // TODO: not sure what this represents
  repeated PokemonSpawnEnd spawn_end = 10;
  repeated Pokemon pokemon_in_area = 11;
}

// This could probably be moved to shared .proto
enum Team {
  UNDEFINED = 0;
  BLUE = 1;
  RED = 2;
  YELLOW = 3;
}

// A "fort" is the internal name for a gym or pokestop point of interest
message Fort {
  string id = 1;
  uint64 timestamp = 2;
  double latitude = 3;
  double longitude = 4;

  // applies only to a gym fort
  Team team = 5; // the team that owns the gym currently
  uint64 guard_pokemon_id = 6; // the pokedex number of the highest cp pokemon in the gym
  bool not_sure8 = 8;
  bool is_pokestop = 9; // applies only to a pokestop fort
  uint64 prestige = 10; // gym's experience / prestige
  bool is_in_battle = 11; // whether the gym is currently being battled

  // applies only to a pokestop fort with a lure attached
  bytes active_module_id = 12; // TODO: needs validation
  FortLureInfo fort_lure_info = 13;

  // applies only to a pokestop fort
  uint64 reset_ts = 14; // the time at which the pokestop can be activated again
}

message FortLureInfo {
  string fort_id = 1;
  double not_sure2 = 2; // TODO: not sure what this is
  uint64 pokedex_number = 3; // TODO: needs validation, seems to be the pokedex number of the pokemon at the lure
  uint64 expiry_ts = 4; // when the lure will end
}

message PokemonSpawnStart {
  double uid = 1;
  uint64 appeared_ts = 2; // TODO: needs validation, seems to be when the pokemon first appeared
  double latitude = 3;
  double longitude = 4;

  // S2 geographic area that this pokemon is in (http://s2map.com/) (https://code.google.com/archive/p/s2-geometry-library/)
  string s2cell_token = 5;

  message PokedexNumber {
    uint64 pokedex_number = 2;
  }
  PokedexNumber pokedex_number = 7;

  int32 not_sure11 = 11; // TODO: not sure what this is
}

message PokemonSpawnEnd {
    // S2 geographic area that this pokemon is in (http://s2map.com/) (https://code.google.com/archive/p/s2-geometry-library/)
    string s2cell_token = 1;

    double uid = 2;
    uint64 pokedex_number = 3;
    uint64 expiry_ts = 4; // when the pokemon will disappear
    double latitude = 5;
    double longitude = 6;
}

message Pokemon {
  uint64 pokedex_number = 1;
  float distance = 2; // TODO: needs validation, seems to be distance in meters
  double id = 3;
}

message Location {
  double latitude = 2;
  double longitude = 3;
}
